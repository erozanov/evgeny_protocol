---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import DraggableCard from '../components/DraggableCard.tsx';
import PortraitDeck from '../components/PortraitDeck.tsx';
import SocialLinks from '../components/SocialLinks.astro';

// Data Fetching
const gardenPosts = (await getCollection('garden')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const portfolioItems = (await getCollection('portfolio')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const workItems = (await getCollection('work')).sort(
  (a, b) => b.data.startDate.valueOf() - a.data.startDate.valueOf()
);

// Helpers
function getPosition(seed, index) {
  const hash = seed.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) + (index * 73);
  const top = (hash % 60) + 10; 
  const left = ((hash * 13) % 75) + 5;
  const rotate = (hash % 12) - 6; 
  return { top: `${top}%`, left: `${left}%`, transform: `rotate(${rotate}deg)` };
}

const formatDate = (date) => {
  return new Date(date).toLocaleDateString('en-US', { year: 'numeric' });
};
---

<Layout title="Evgeniy Rozanov â€” Blockchain Architect">
  
  {/* --- HERO SECTION: STATIC --- */}
  <section class="w-full bg-white border-b-4 border-black px-4 py-8 md:py-20">
    <div class="max-w-6xl mx-auto grid md:grid-cols-[350px_1fr] gap-8 md:gap-12 items-start">
      
      {/* Photo Column - Mobile Optimized */}
      <div class="relative group mx-auto md:mx-0 w-full max-w-[280px] md:max-w-none">
        <div class="hidden md:block absolute inset-0 bg-black translate-x-3 translate-y-3"></div>
        <div class="relative w-full aspect-[3/4] z-10">
          <PortraitDeck
            client:load
            className="w-full h-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] md:shadow-none"
            images={[
              '/images/nice_2025.jpg'
            ]}
          />
        </div>
      </div>

      {/* Info Column */}
      <div class="space-y-6 md:space-y-8 font-mono text-center md:text-left">
        <div>
          <h1 class="text-4xl md:text-7xl font-black uppercase tracking-tighter leading-[0.9] mb-4">
            Blockchain<br/>Architect &<br/>Technical<br/>Manager
          </h1>
          <p class="text-lg md:text-2xl font-bold uppercase leading-tight bg-[#d946ef] text-white inline-block px-2 border-2 border-black transform -rotate-1 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            Software Engineer / Web3 / Tech Lead
          </p>
        </div>

        <div class="border-t-4 border-b-4 md:border-t-0 md:border-b-0 md:border-l-4 border-black py-4 md:pl-6 md:py-2 space-y-4 max-w-2xl mx-auto md:mx-0 bg-gray-50 md:bg-transparent p-4 md:p-0 mt-6 md:mt-0">
          <p class="text-base md:text-lg opacity-80 leading-relaxed">
            As a <span class="font-bold">Technical Project Manager</span>, I build scalable decentralized systems. With <span class="font-bold">12+ years</span> of engineering experience and a deep focus on <span class="font-bold">DeFi & Liquid Staking</span>, I bridge the gap between complex protocol architecture and product reality.
          </p>
          
          <SocialLinks />
        </div>
      </div>
    </div>

    {/* Scroll Down Arrow with Label */}
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 hidden md:flex flex-col items-center gap-2 z-20">
      <span class="text-[10px] font-black uppercase tracking-[0.3em] text-gray-400 select-none">
        Contact Me
      </span>
      <a href="#contact" class="text-black hover:text-[#d946ef] transition-colors animate-bounce" aria-label="Scroll Down to Contacts">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="square" stroke-linejoin="miter">
          <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
        </svg>
      </a>
    </div>
  </section>

  {/* --- PROJECTS & WORK: SEMI-STATIC GRID --- */}
  <section id="professional-track" class="w-full bg-gray-50 border-b-4 border-black px-4 py-12 md:py-16">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 md:mb-12 border-b-4 border-black pb-4 gap-4">
        <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight">Professional Track</h2>
        <a href="/about#work-history" class="w-full md:w-auto text-center font-bold uppercase text-sm border-2 border-black px-4 py-2 bg-white hover:bg-black hover:text-white transition-colors shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
          View Full Timeline
        </a>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {/* Render top 3 work items as static cards */}
        {workItems.slice(0, 3).map((job) => (
          <div class="bg-white border-4 border-black p-6 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all cursor-default">
            <div class="flex justify-between items-start mb-4">
               <h3 class="font-black text-xl md:text-2xl uppercase leading-none">{job.data.company}</h3>
               <span class="text-[10px] md:text-xs font-bold border border-black px-1 bg-gray-100 whitespace-nowrap">{formatDate(job.data.startDate)}</span>
            </div>
            <p class="font-bold text-xs md:text-sm uppercase mb-4 text-gray-500">{job.data.role}</p>
            <p class="text-sm leading-relaxed line-clamp-3 mb-4 font-mono opacity-80">{job.data.description}</p>
            <div class="flex flex-wrap gap-1">
              {job.data.tags && job.data.tags.slice(0, 3).map(tag => (
                <span class="text-[10px] uppercase font-bold bg-black text-white px-1">#{tag}</span>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  {/* --- DIGITAL GARDEN: INTERACTIVE PLAYGROUND --- */}
  <section class="w-full relative h-[80vh] overflow-hidden bg-white border-b-4 border-black">
    {/* Section Header (Absolute) */}
    <div class="absolute top-4 left-4 md:top-8 md:left-8 z-40 pointer-events-none">
       <h2 class="text-5xl md:text-8xl font-black uppercase text-gray-100 select-none">Garden</h2>
       <p class="absolute top-1/2 left-2 text-lg md:text-xl font-bold uppercase bg-black text-white px-2 -rotate-2">
         Digital Garden
       </p>
    </div>

    <div class="absolute inset-0 pointer-events-none z-0 grid grid-cols-[repeat(auto-fill,minmax(50px,1fr))] gap-px opacity-[0.03]">
      {Array.from({ length: 400 }).map((_, i) => (
        <div class="border border-black aspect-square"></div>
      ))}
    </div>

    <div class="absolute inset-0" id="garden-workspace">
      {/* Enhanced WIP System Card */}
      <DraggableCard
        client:load
        title="PROTOCOL: GARDEN"
        className="top-[35%] left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black text-white w-80 z-30 shadow-[12px_12px_0px_0px_rgba(217,70,239,0.3)] border-[#d946ef]"
        dragConstraints={{ left: -1000, right: 1000, top: -500, bottom: 500 }}
      >
        <div class="space-y-4 p-2">
          <p class="font-mono text-sm font-bold uppercase leading-relaxed text-[#d946ef] animate-pulse">
            [ STATUS: GROWING ]
          </p>
          <p class="font-mono text-xs opacity-70">
            The Digital Garden is currently being seeded with architectural notes, protocol experiments, and mental models.
          </p>
          <div class="pt-2 border-t border-white/20 flex justify-between items-center text-[10px] uppercase font-black tracking-widest">
             <span>v.0.1.beta</span>
             <span>Locked</span>
          </div>
        </div>
      </DraggableCard>

      {/* Abstract Seedling Cards for visual density */}
      <DraggableCard
        client:load
        title="NODE_01"
        style={{ top: '20%', left: '15%', rotate: '-4deg' }}
        className="bg-white/50 backdrop-blur-sm border-gray-200 w-48 z-10"
        dragConstraints={{ left: -1000, right: 1000, top: -500, bottom: 500 }}
      >
        <div class="h-24 flex items-center justify-center border-2 border-dashed border-gray-200 text-gray-300 font-black text-4xl">?</div>
      </DraggableCard>

      <DraggableCard
        client:load
        title="NODE_02"
        style={{ top: '60%', left: '75%', rotate: '6deg' }}
        className="bg-white/50 backdrop-blur-sm border-gray-200 w-48 z-10"
        dragConstraints={{ left: -1000, right: 1000, top: -500, bottom: 500 }}
      >
        <div class="h-24 flex items-center justify-center border-2 border-dashed border-gray-200 text-gray-300 font-black text-4xl">?</div>
      </DraggableCard>

      <DraggableCard
        client:load
        title="NODE_03"
        style={{ top: '15%', left: '70%', rotate: '2deg' }}
        className="bg-white/50 backdrop-blur-sm border-gray-200 w-48 z-10"
        dragConstraints={{ left: -1000, right: 1000, top: -500, bottom: 500 }}
      >
        <div class="h-24 flex items-center justify-center border-2 border-dashed border-gray-200 text-gray-300 font-black text-4xl">?</div>
      </DraggableCard>

    </div>
  </section>

</Layout>

<style>
  /* Custom scrollbar for brutalism */
  ::-webkit-scrollbar {
    width: 12px;
  }
  ::-webkit-scrollbar-track {
    background: #000; 
  }
  ::-webkit-scrollbar-thumb {
    background: #fff; 
    border: 2px solid #000;
  }
</style>
